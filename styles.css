/* Runbook Plugin Styles */

/* ==================== CSS CUSTOM PROPERTIES ==================== */
/* Design tokens for consistent theming and easier maintenance */

.theme-dark,
.theme-light {
	/* Spacing scale (4px base unit) */
	--rb-spacing-xs: 4px;
	--rb-spacing-sm: 8px;
	--rb-spacing-md: 12px;
	--rb-spacing-lg: 16px;
	--rb-spacing-xl: 20px;

	/* Typography */
	--rb-font-size-xs: 10px;
	--rb-font-size-sm: 11px;
	--rb-font-size-md: 12px;
	--rb-font-size-base: 13px;
	--rb-font-size-lg: 14px;
	--rb-line-height-normal: 1.5;

	/* Border radius */
	--rb-radius-sm: 2px;
	--rb-radius-md: 4px;
	--rb-radius-lg: 6px;

	/* Icon sizes */
	--rb-icon-sm: 14px;
	--rb-icon-md: 16px;
	--rb-icon-lg: 20px;
	--rb-icon-xl: 24px;

	/* Animation timing */
	--rb-duration-fast: 100ms;
	--rb-duration-normal: 200ms;
	--rb-duration-slow: 300ms;

	/* Z-index scale */
	--rb-z-base: 0;
	--rb-z-elevated: 10;
	--rb-z-dropdown: 50;

	/* Semantic colors (inherit from Obsidian) */
	--rb-color-success: var(--text-success, #0dbc79);
	--rb-color-warning: var(--text-warning, #e5e510);
	--rb-color-error: var(--text-error, #cd3131);
	--rb-color-info: var(--text-accent);
}

/* ==================== RUN BUTTON (top-right, next to native copy) ==================== */

.rb-run-button.clickable-icon {
	position: absolute;
	top: 0;
	right: 34px;
	margin: var(--rb-spacing-xs);
	padding: var(--rb-spacing-xs) 6px;
	height: auto;
	background-color: transparent;
	box-shadow: none;
	color: var(--text-muted);
	font-size: var(--font-ui-smaller);
	border: 0;
	border-radius: var(--button-radius);
	cursor: pointer;
	opacity: 0;
	z-index: var(--rb-z-elevated);
	transition: opacity var(--rb-duration-fast) ease-in-out;
}

.rb-run-button.clickable-icon:hover {
	color: var(--text-normal);
	background: var(--background-modifier-hover);
}

/* Show on pre hover */
pre:hover .rb-run-button.clickable-icon {
	opacity: 1;
}

/* Running state - always visible */
.rb-run-button.is-running {
	color: var(--text-accent);
	opacity: 1 !important;
}

.rb-run-button.is-running svg {
	animation: rb-spin 1s linear infinite;
}

@keyframes rb-spin {
	from { transform: rotate(0deg); }
	to { transform: rotate(360deg); }
}

/* Output area buttons - keep consistent styling */
.rb-cell-btn.clickable-icon {
	--icon-size: var(--rb-icon-md);
	color: var(--text-muted);
	background: transparent;
	padding: var(--rb-spacing-xs);
	border-radius: var(--rb-radius-md);
	border: none;
	cursor: pointer;
}

.rb-cell-btn.clickable-icon:hover {
	color: var(--text-normal);
	background: var(--background-modifier-hover);
}

/* ==================== CODE AREA ==================== */

.rb-cell-code {
	background: var(--background-secondary-alt);
	border-bottom: 1px solid var(--background-modifier-border);
}

/* Reset pre styling inside cell */
.rb-cell-code pre {
	position: relative;
	margin: 0 !important;
	padding: var(--rb-spacing-lg) var(--rb-spacing-md) !important;
	background: transparent !important;
	border: none !important;
	border-radius: 0 !important;
}

.rb-cell-code pre code {
	background: transparent !important;
}

/* ==================== OUTPUT AREA ==================== */

.rb-cell-output {
	position: relative;
	background: var(--background-secondary);
	padding: var(--rb-spacing-xs) var(--rb-spacing-md);
	min-height: 40px;
}

/* Empty state - more subtle */
.rb-cell-output.is-empty {
	opacity: 0.5;
}

.rb-cell-output.is-empty .rb-cell-output-body {
	display: none;
}

/* Error state */
.rb-cell-output.has-error .rb-cell-output-title {
	color: var(--text-error);
}

/* Output header */
.rb-cell-output-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: var(--rb-spacing-sm);
}

.rb-cell-output-title {
	font-size: var(--rb-font-size-sm);
	font-weight: 500;
	color: var(--text-muted);
	text-transform: uppercase;
	letter-spacing: 0.5px;
}

/* Output action buttons */
.rb-cell-output-actions {
	display: flex;
	gap: 2px;
	opacity: 0;
	transition: opacity var(--rb-duration-normal) ease;
}

.rb-cell-output:hover .rb-cell-output-actions {
	opacity: 1;
}

/* Output body */
.rb-cell-output-body {
	font-family: var(--font-monospace);
	font-size: var(--rb-font-size-base);
	line-height: var(--rb-line-height-normal);
}

.rb-cell-output-body pre {
	margin: 0 !important;
	padding: 0 !important;
	background: transparent !important;
	border: none !important;
	white-space: pre-wrap;
	word-wrap: break-word;
	color: var(--text-normal);
	font-family: inherit;
	font-size: inherit;
	line-height: inherit;
}

/* Error output */
.rb-cell-output-body pre.rb-cell-error {
	color: var(--text-error);
}

/* Empty output message */
.rb-cell-output-empty {
	color: var(--text-faint);
	font-style: italic;
	font-size: var(--rb-font-size-md);
}

/* ==================== SPINNER ==================== */

.rb-cell-spinner {
	display: flex;
	justify-content: center;
	align-items: center;
	padding: var(--rb-spacing-md);
}

.rb-cell-spinner::after {
	content: "";
	width: var(--rb-icon-lg);
	height: var(--rb-icon-lg);
	border: 2px solid var(--background-modifier-border);
	border-top-color: var(--rb-color-info);
	border-radius: 50%;
	animation: rb-spin 0.8s linear infinite;
}

/* ==================== UTILITY CLASSES ==================== */

.runbook-output-container.is-hidden {
	display: none;
}

/* ==================== XTERM.JS STYLES ==================== */
/* Core xterm.js library CSS (required for rendering) */

.xterm {
	cursor: text;
	position: relative;
	user-select: none;
	-ms-user-select: none;
	-webkit-user-select: none;
}
.xterm.focus, .xterm:focus {
	outline: none;
}
.xterm .xterm-helpers {
	position: absolute;
	top: 0;
	z-index: 5;
}
.xterm .xterm-helper-textarea {
	padding: 0;
	border: 0;
	margin: 0;
	position: absolute;
	opacity: 0;
	left: -9999em;
	top: 0;
	width: 0;
	height: 0;
	z-index: -5;
	white-space: nowrap;
	overflow: hidden;
	resize: none;
}
.xterm .composition-view {
	background: #000;
	color: #FFF;
	display: none;
	position: absolute;
	white-space: nowrap;
	z-index: 1;
}
.xterm .composition-view.active {
	display: block;
}
.xterm .xterm-viewport {
	background-color: #000;
	overflow-y: scroll;
	cursor: default;
	position: absolute;
	right: 0;
	left: 0;
	top: 0;
	bottom: 0;
}
.xterm .xterm-screen {
	position: relative;
}
.xterm .xterm-screen canvas {
	position: absolute;
	left: 0;
	top: 0;
}
.xterm .xterm-scroll-area {
	visibility: hidden;
}
.xterm-char-measure-element {
	display: inline-block;
	visibility: hidden;
	position: absolute;
	top: 0;
	left: -9999em;
	line-height: normal;
}
.xterm.enable-mouse-events {
	cursor: default;
}
.xterm.xterm-cursor-pointer, .xterm .xterm-cursor-pointer {
	cursor: pointer;
}
.xterm.column-select.focus {
	cursor: crosshair;
}
.xterm .xterm-accessibility, .xterm .xterm-message {
	position: absolute;
	left: 0;
	top: 0;
	bottom: 0;
	right: 0;
	z-index: 10;
	color: transparent;
	pointer-events: none;
}
.xterm .live-region {
	position: absolute;
	left: -9999px;
	width: 1px;
	height: 1px;
	overflow: hidden;
}
.xterm-dim {
	opacity: 1 !important;
}
.xterm-underline-1 { text-decoration: underline; }
.xterm-underline-2 { text-decoration: double underline; }
.xterm-underline-3 { text-decoration: wavy underline; }
.xterm-underline-4 { text-decoration: dotted underline; }
.xterm-underline-5 { text-decoration: dashed underline; }
.xterm-overline { text-decoration: overline; }
.xterm-overline.xterm-underline-1 { text-decoration: overline underline; }
.xterm-overline.xterm-underline-2 { text-decoration: overline double underline; }
.xterm-overline.xterm-underline-3 { text-decoration: overline wavy underline; }
.xterm-overline.xterm-underline-4 { text-decoration: overline dotted underline; }
.xterm-overline.xterm-underline-5 { text-decoration: overline dashed underline; }
.xterm-strikethrough { text-decoration: line-through; }
.xterm-screen .xterm-decoration-container .xterm-decoration { z-index: 6; position: absolute; }
.xterm-screen .xterm-decoration-container .xterm-decoration.xterm-decoration-top-layer { z-index: 7; }
.xterm-decoration-overview-ruler { z-index: 8; position: absolute; top: 0; right: 0; pointer-events: none; }
.xterm-decoration-top { z-index: 2; position: relative; }

/* ==================== TERMINAL VIEW STYLES ==================== */

.runbook-xterm-view {
	display: flex;
	flex-direction: column;
	height: 100%;
	padding: 0;
	overflow: hidden;
}

.runbook-xterm-container {
	flex: 1;
	min-height: 0;
	padding: 4px;
}

.runbook-xterm-container .xterm {
	height: 100%;
}

.runbook-xterm-container .xterm-viewport {
	overflow-y: auto;
}

.runbook-xterm-container .xterm-viewport::-webkit-scrollbar {
	width: 8px;
}

.runbook-xterm-container .xterm-viewport::-webkit-scrollbar-track {
	background: transparent;
}

.runbook-xterm-container .xterm-viewport::-webkit-scrollbar-thumb {
	background-color: var(--background-modifier-border);
	border-radius: 4px;
}

.runbook-xterm-container .xterm-viewport::-webkit-scrollbar-thumb:hover {
	background-color: var(--background-modifier-border-hover);
}

/* Developer console styles */
.runbook-dev-console-view {
	display: flex;
	flex-direction: column;
	height: 100%;
	padding: 0;
	overflow: hidden;
}

.runbook-dev-console-container {
	flex: 1;
	min-height: 0;
	padding: 4px;
}

.runbook-dev-console-container .xterm {
	height: 100%;
}

/* Status bar terminal indicator */
.runbook-status-bar-item {
	display: flex;
	align-items: center;
	gap: 4px;
	cursor: pointer;
}

.runbook-status-bar-item:hover {
	color: var(--text-accent);
}

.runbook-status-bar-item .status-icon {
	font-size: 14px;
}

.runbook-status-bar-item.has-terminals .status-icon {
	color: var(--text-success);
}

.runbook-status-bar-item.no-terminals .status-icon {
	color: var(--text-muted);
}
